!! Test basic detachment during assignment
!! When f = [b]{r = a+b}, 'a' resolves at assignment time, 'b' is detached

{
    a = 1;
    f = [b]{r = a + b};
    b = 3;
    x =$ f;              !! Should be 4: a captured as 1, b resolves to 3

    !! Nested case: detachment within detachment
    {
        c = 10;
        g = [d]{
            inner = [e]{result = c + d + e};
            result =$ inner
        };
        !! c captured as 10, d detached, e detached
        d = 20;
        e = 5;
        y =$ g;          !! Should be 35: c=10, d=20, e=5
    };

    !! Test with multiple detached ordinates
    h = [p, q, r]{sum = p + q + r};
    p = 1; q = 2; r = 3;
    z =$ h;              !! Should be 6
}
